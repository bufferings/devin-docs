---
layout: default
title: トラブルシューティング
nav_order: 5
parent: ecspresso
---

# トラブルシューティング

ecspressoを使用する際に発生する可能性のある一般的な問題とその解決方法を説明します。

## デプロイの失敗

### 症状
`ecspresso deploy`コマンドが失敗し、エラーメッセージが表示される。

### 考えられる原因と解決策

1. **タスク定義の問題**
   - コンテナ定義が無効
   - リソース制限（CPU/メモリ）が無効
   - IAMロールが存在しないか権限が不足

   **解決策**: `ecspresso verify`コマンドを実行して設定を検証し、エラーを修正してください。

2. **サービス定義の問題**
   - ロードバランサーの設定が無効
   - ネットワーク設定が無効
   - 配置制約が無効

   **解決策**: `ecspresso diff`コマンドを実行して、現在のサービスとの差分を確認し、問題を特定してください。

3. **AWS APIの制限**
   - API呼び出しの制限に達した

   **解決策**: しばらく待ってから再試行してください。

4. **権限の問題**
   - AWS認証情報に必要な権限がない

   **解決策**: IAMポリシーを確認し、必要な権限を追加してください。

## タスクの起動失敗

### 症状
タスクが起動するが、すぐに停止する。

### 考えられる原因と解決策

1. **コンテナのクラッシュ**
   - アプリケーションエラー
   - メモリ不足

   **解決策**: `ecspresso exec`または`ecspresso tasks`コマンドを使用してログを確認し、アプリケーションの問題を特定してください。

2. **ヘルスチェックの失敗**
   - コンテナのヘルスチェックが失敗している

   **解決策**: ヘルスチェックの設定を確認し、アプリケーションが正しく応答しているか確認してください。

3. **ネットワーク問題**
   - セキュリティグループの設定が不適切
   - サブネットの設定が不適切

   **解決策**: ネットワーク設定を確認し、必要なポートが開放されているか確認してください。

## デバッグ方法

### ログの有効化

詳細なログを有効にするには、`--debug`オプションを使用します：

```bash
ecspresso deploy --debug
```

### AWS ECSコンソールの確認

AWS ECSコンソールでサービスとタスクの状態を確認することも有効です：

1. AWSコンソールにログイン
2. ECSサービスに移動
3. クラスターとサービスを選択
4. イベントタブとタスクタブを確認

### CloudWatchログの確認

タスクのログをCloudWatchで確認する方法：

1. タスクIDを取得: `ecspresso tasks`
2. ログを確認: `ecspresso exec --id <task-id> --command "cat /path/to/log"`
3. または、AWSコンソールのCloudWatchログセクションで確認

## よくある質問

### Q: `ecspresso deploy`が「サービスが見つかりません」というエラーで失敗します。
A: サービス名とクラスター名が正しいか確認してください。また、AWS認証情報が正しいリージョンを指しているか確認してください。

### Q: タスク定義の登録に失敗します。
A: タスク定義のJSONが有効かどうか確認してください。`ecspresso verify`コマンドを使用して検証できます。

### Q: デプロイが完了しても、サービスが安定しません。
A: `ecspresso status`コマンドを使用してサービスの状態とイベントを確認し、問題を特定してください。また、タスクのログも確認してください。

### Q: CodeDeployを使用したデプロイが失敗します。
A: CodeDeployの設定が正しいか確認してください。また、CodeDeployコンソールでデプロイの詳細を確認してください。
